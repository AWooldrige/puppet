{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS Infrastructure for Public Facing Sites",
    "Parameters" : { },
    "Resources": {
        "wooliecoukDNS": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": "woolie.co.uk.",
                "RecordSets": [
                    {
                        "Name": "cg.woolie.co.uk.",
                        "Type": "CNAME",
                        "TTL": "3600",
                        "ResourceRecords": [ "cg.wooldrige.co.uk" ]
                    },
                    {
                        "Name": "woolie.co.uk.",
                        "Type": "MX",
                        "TTL": "86400",
                        "ResourceRecords": [
                            "10 ASPMX.L.GOOGLE.COM.",
                            "20 ALT1.ASPMX.L.GOOGLE.COM.",
                            "20 ALT2.ASPMX.L.GOOGLE.COM.",
                            "30 ASPMX2.GOOGLEMAIL.COM.",
                            "30 ASPMX3.GOOGLEMAIL.COM.",
                            "30 ASPMX4.GOOGLEMAIL.COM.",
                            "30 ASPMX5.GOOGLEMAIL.COM."
                        ]
                    },
                    {
                        "Name": "google._domainkey.woolie.co.uk.",
                        "Type": "TXT",
                        "TTL": "86400",
                        "ResourceRecords": [ "\"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCD9iFbc2P35/Uay6FSHGs7hFM0je8NnpjyrAnpJDMnRKFA+5ISUrv9C3IwAQliRUMlzWkwMmFE773i7E3g3/mcyuRZCBTOLJ0WBtSZoqEWyCFG/y8RXIi+Tf0d/qBDzBE+zB8Rjl3XggEwSk7AsKz8YrodzpMI38l0EWlyOFd0tQIDAQAB\"" ]
                    },
                    {
                        "Name": "mail.woolie.co.uk.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    },
                    {
                        "Name": "docs.woolie.co.uk.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    },
                    {
                        "Name": "calendar.woolie.co.uk.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    }
                ]
            }
        },
        "onmyplatecoukDNS": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": "onmyplate.co.uk.",
                "RecordSets": [
                    {
                        "Name": "onmyplate.co.uk.",
                        "Type": "MX",
                        "TTL": "86400",
                        "ResourceRecords": [
                            "10 ASPMX.L.GOOGLE.COM.",
                            "20 ALT1.ASPMX.L.GOOGLE.COM.",
                            "20 ALT2.ASPMX.L.GOOGLE.COM.",
                            "30 ASPMX2.GOOGLEMAIL.COM.",
                            "30 ASPMX3.GOOGLEMAIL.COM.",
                            "30 ASPMX4.GOOGLEMAIL.COM.",
                            "30 ASPMX5.GOOGLEMAIL.COM."
                        ]
                    },
                    {
                        "Name": "google._domainkey.onmyplate.co.uk.",
                        "Type": "TXT",
                        "TTL": "86400",
                        "ResourceRecords": [ "\"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDMacew9nMsqyDqfiHyyViASAbAvPix7l+SCMrRnSSDrG6WRMT54btieUmK9tzOi39U8LMi/l29IwJOy908KY+ydkNK2n7AP0I1AJExsdzU/g92L+WMAPEI0UOep+v6i+Plv1zjFLejo0OKy5JHdk3A9PQaOLyOjpxKAN/mNhcMnQIDAQAB\"" ]
                    },
                    {
                        "Name": "CI4ZOCDZDOYT.onmyplate.co.uk.",
                        "Type": "CNAME",
                        "TTL": "1209600",
                        "ResourceRecords": [ "gv-SBHCIDQ6WSTITK.dv.googlehosted.com." ]
                    }
                ]
            }
        },
        "wooldrigecoukDNS": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": "wooldrige.co.uk.",
                "RecordSets": [
                    {
                        "Name": "wooldrige.co.uk.",
                        "Type": "MX",
                        "TTL": "86400",
                        "ResourceRecords": [
                            "10 ASPMX.L.GOOGLE.COM.",
                            "20 ALT1.ASPMX.L.GOOGLE.COM.",
                            "20 ALT2.ASPMX.L.GOOGLE.COM.",
                            "30 ASPMX2.GOOGLEMAIL.COM.",
                            "30 ASPMX3.GOOGLEMAIL.COM.",
                            "30 ASPMX4.GOOGLEMAIL.COM.",
                            "30 ASPMX5.GOOGLEMAIL.COM."
                        ]
                    },
                    {
                        "Name": "google._domainkey.wooldrige.co.uk.",
                        "Type": "TXT",
                        "TTL": "86400",
                        "ResourceRecords": [ "\"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDEgZWLAgAXgZZIkAC4Na4xU3UmFkuIvj3a4AHW3K45vN3BeiBQ5mYC5g/KcrXZhDsaWzp9qgi9chtT3CV/E4ZA8SDeJxmyVCu8PWxXBTc9akFah3lp3mgtLZY+sMrfGlMTdHFzJ1I7FlttFeCAMUXm2ZsQyoXqaIS9Ojjy1ddikQIDAQAB\"" ]
                    }
                ]
            }
        },
        "kempstonnurseriescoukDNS": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": "kempstonnurseries.co.uk.",
                "RecordSets": [
                    {
                        "Name": "ZQJYDD6YQE2G.kempstonnurseries.co.uk.",
                        "Type": "CNAME",
                        "TTL": "1209600",
                        "ResourceRecords": [ "gv-KHYQWCRKN2VBQN.dv.googlehosted.com." ]
                    }
                ]
            }
        },
        "brignellbookbindersDNS": {
            "Type": "AWS::Route53::RecordSetGroup",
            "Properties": {
                "HostedZoneName": "brignellbookbinders.com.",
                "RecordSets": [
                    {
                        "Name": "mail.brignellbookbinders.com.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    },
                    {
                        "Name": "docs.brignellbookbinders.com.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    },
                    {
                        "Name": "calendar.brignellbookbinders.com.",
                        "Type": "CNAME",
                        "TTL": "86400",
                        "ResourceRecords": [ "ghs.google.com" ]
                    },
                    {
                        "Name": "brignellbookbinders.com.",
                        "Type": "MX",
                        "TTL": "86400",
                        "ResourceRecords": [
                            "10 ASPMX.L.GOOGLE.COM.",
                            "20 ALT1.ASPMX.L.GOOGLE.COM.",
                            "20 ALT2.ASPMX.L.GOOGLE.COM.",
                            "30 ASPMX2.GOOGLEMAIL.COM.",
                            "30 ASPMX3.GOOGLEMAIL.COM.",
                            "30 ASPMX4.GOOGLEMAIL.COM.",
                            "30 ASPMX5.GOOGLEMAIL.COM."
                        ]
                    }
                ]
            }
        },
        "IAMUserRaspberryPi": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "Groups": [
                    { "Ref": "IAMGroupDynamicDNS" }
                ]
            }
        },
        "IAMGroupDynamicDNS": {
            "Type": "AWS::IAM::Group",
            "Properties": {
                "Policies": [ {
                    "PolicyName" : "onlyallowtoupdatewooldrigecouk",
                    "PolicyDocument": {
                        "Statement" : [
                            {
                                "Effect":"Allow",
                                "Action":[
                                    "route53:ChangeResourceRecordSets",
                                    "route53:GetChange",
                                    "route53:ListResourceRecordSets",
                                    "route53:GetHostedZone"
                                ],
                                "Resource":"arn:aws:route53:::hostedzone/Z1VIBQX07I3Y3K"
                            },
                            {
                                "Effect":"Allow",
                                "Action":[ "route53:GetChange" ],
                                "Resource":"arn:aws:route53:::change/*"
                            }
                        ]
                    }
                } ]
            }
        },
        "WwwWoolieCoUkWerckerDeployUser": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "Groups": [
                    { "Ref": "WwwWoolieCoUkBucketReadWriteGroup" }
                ]
            }
        },
        "WwwOnmyplateCoUkWerckerDeployUser": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "Groups": [
                    { "Ref": "WwwOnmyplateCoUkBucketReadWriteGroup" }
                ]
            }
        },
        "WwwKempstonnurseriesCoUkWerckerDeployUser": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "Groups": [
                    { "Ref": "WwwKempstonnurseriesCoUkBucketReadWriteGroup" }
                ]
            }
        },
        "WwwBrignellbookbindersComWerckerDeployUser": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "Groups": [
                    { "Ref": "WwwBrignellbookbindersComBucketReadWriteGroup" }
                ]
            }
        },
        "WwwWoolieCoUkCloudFrontCDN": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Aliases": [ "www.woolie.co.uk" ],
                    "Origins": [
                        {
                            "DomainName": "www.woolie.co.uk.s3-website-eu-west-1.amazonaws.com",
                            "Id": "www.woolie.co.uk",
                            "CustomOriginConfig": {
                                "OriginProtocolPolicy": "http-only"
                            }
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "TargetOriginId": "www.woolie.co.uk",
                        "ForwardedValues": {
                            "QueryString": false
                        },
                        "ViewerProtocolPolicy": "allow-all"
                    },
                    "Enabled": "true"
                }
            }
        },
        "WwwOnmyplateCoUkCloudFrontCDN": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Aliases": [ "www.onmyplate.co.uk" ],
                    "Origins": [
                        {
                            "DomainName": "www.onmyplate.co.uk.s3-website-eu-west-1.amazonaws.com",
                            "Id": "www.onmyplate.co.uk",
                            "CustomOriginConfig": {
                                "OriginProtocolPolicy": "http-only"
                            }
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "TargetOriginId": "www.onmyplate.co.uk",
                        "ForwardedValues": {
                            "QueryString": false
                        },
                        "ViewerProtocolPolicy": "allow-all"
                    },
                    "Enabled": "true"
                }
            }
        },
        "WwwKempstonnurseriesCoUkCloudFrontCDN": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Aliases": [ "www.kempstonnurseries.co.uk" ],
                    "Origins": [
                        {
                            "DomainName": "www.kempstonnurseries.co.uk.s3-website-eu-west-1.amazonaws.com",
                            "Id": "www.kempstonnurseries.co.uk",
                            "CustomOriginConfig": {
                                "OriginProtocolPolicy": "http-only"
                            }
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "TargetOriginId": "www.kempstonnurseries.co.uk",
                        "ForwardedValues": {
                            "QueryString": false
                        },
                        "ViewerProtocolPolicy": "allow-all"
                    },
                    "Enabled": "true"
                }
            }
        },
        "WwwBrignellbookbindersComCloudFrontCDN": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Aliases": [ "www.brignellbookbinders.com" ],
                    "Origins": [
                        {
                            "DomainName": "www.brignellbookbinders.com.s3-website-eu-west-1.amazonaws.com",
                            "Id": "www.brignellbookbinders.com",
                            "CustomOriginConfig": {
                                "OriginProtocolPolicy": "http-only"
                            }
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "TargetOriginId": "www.brignellbookbinders.com",
                        "ForwardedValues": {
                            "QueryString": false
                        },
                        "ViewerProtocolPolicy": "allow-all"
                    },
                    "Enabled": "true"
                }
            }
        },
       "WwwWoolieCoUkWebsiteBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "www.woolie.co.uk",
                "WebsiteConfiguration" : {
                    "IndexDocument" : "index.html"
                }
            },
            "DeletionPolicy" : "Retain"
        },
       "WwwOnmyplateCoUkWebsiteBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "www.onmyplate.co.uk",
                "WebsiteConfiguration" : {
                    "IndexDocument" : "index.html"
                }
            },
            "DeletionPolicy" : "Retain"
        },
       "WwwKempstonnurseriesCoUkWebsiteBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "www.kempstonnurseries.co.uk",
                "WebsiteConfiguration" : {
                    "IndexDocument" : "index.html"
                }
            },
            "DeletionPolicy" : "Retain"
        },
       "WwwBrignellbookbindersComWebsiteBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "www.brignellbookbinders.com",
                "WebsiteConfiguration" : {
                    "IndexDocument" : "index.html"
                }
            },
            "DeletionPolicy" : "Retain"
        },
       "WoolieCoUkRedirectBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "woolie.co.uk"
            },
            "DeletionPolicy" : "Retain"
        },
       "OnmyplateCoUkRedirectBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "onmyplate.co.uk"
            },
            "DeletionPolicy" : "Retain"
        },
       "KempstonnurseriesCoUkRedirectBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "kempstonnurseries.co.uk"
            },
            "DeletionPolicy" : "Retain"
        },
       "BrignellbookbindersComRedirectBucket" : {
            "Type" : "AWS::S3::Bucket",
            "Properties" : {
                "AccessControl" : "PublicRead",
                "BucketName" : "brignellbookbinders.com"
            },
            "DeletionPolicy" : "Retain"
        },
        "WwwWoolieCoUkBucketReadWriteGroup": {
            "Type": "AWS::IAM::Group",
            "Properties": {
                "Policies": [ {
                    "PolicyName" : "AllowReadWriteAccessToWwwWoolieCoUkBucket",
                    "PolicyDocument": {
                        "Statement" : [
                            {
                                "Effect":"Allow",
                                "Action":[
                                    "s3:ListBucket",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:GetObjectAcl",
                                    "s3:PutObjectAcl",
                                    "s3:DeleteObject",
                                    "s3:ListMultipartUploadParts"
                                ],
                                "Resource" : { "Fn::Join" : [
                                    "", [ "arn:aws:s3:::", { "Ref" : "WwwWoolieCoUkWebsiteBucket" } , "/*" ]
                                ] }
                            }
                        ]
                    }
                } ]
            }
        },
        "WwwOnmyplateCoUkBucketReadWriteGroup": {
            "Type": "AWS::IAM::Group",
            "Properties": {
                "Policies": [ {
                    "PolicyName" : "AllowReadWriteAccessToWwwOnmyplateCoUkBucket",
                    "PolicyDocument": {
                        "Statement" : [
                            {
                                "Effect":"Allow",
                                "Action":[
                                    "s3:ListBucket",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:GetObjectAcl",
                                    "s3:PutObjectAcl",
                                    "s3:DeleteObject",
                                    "s3:ListMultipartUploadParts"
                                ],
                                "Resource" : { "Fn::Join" : [
                                    "", [ "arn:aws:s3:::", { "Ref" : "WwwOnmyplateCoUkWebsiteBucket" } , "/*" ]
                                ] }
                            }
                        ]
                    }
                } ]
            }
        },
        "WwwKempstonnurseriesCoUkBucketReadWriteGroup": {
            "Type": "AWS::IAM::Group",
            "Properties": {
                "Policies": [ {
                    "PolicyName" : "AllowReadWriteAccessToWwwKempstonnurseriesCoUkBucket",
                    "PolicyDocument": {
                        "Statement" : [
                            {
                                "Effect":"Allow",
                                "Action":[
                                    "s3:ListBucket",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:GetObjectAcl",
                                    "s3:PutObjectAcl",
                                    "s3:DeleteObject",
                                    "s3:ListMultipartUploadParts"
                                ],
                                "Resource" : { "Fn::Join" : [
                                    "", [ "arn:aws:s3:::", { "Ref" : "WwwKempstonnurseriesCoUkWebsiteBucket" } , "/*" ]
                                ] }
                            }
                        ]
                    }
                } ]
            }
        },
        "WwwBrignellbookbindersComBucketReadWriteGroup": {
            "Type": "AWS::IAM::Group",
            "Properties": {
                "Policies": [ {
                    "PolicyName" : "AllowReadWriteAccessToWwwBrignellbookbindersComBucket",
                    "PolicyDocument": {
                        "Statement" : [
                            {
                                "Effect":"Allow",
                                "Action":[
                                    "s3:ListBucket",
                                    "s3:GetObject",
                                    "s3:PutObject",
                                    "s3:GetObjectAcl",
                                    "s3:PutObjectAcl",
                                    "s3:DeleteObject",
                                    "s3:ListMultipartUploadParts"
                                ],
                                "Resource" : { "Fn::Join" : [
                                    "", [ "arn:aws:s3:::", { "Ref" : "WwwBrignellbookbindersComWebsiteBucket" } , "/*" ]
                                ] }
                            }
                        ]
                    }
                } ]
            }
        }
    }
}


